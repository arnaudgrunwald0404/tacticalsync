#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# Check if we're in the right directory
if [ ! -d "supabase/migrations" ]; then
  echo "‚ùå Not in project root directory"
  exit 1
fi

# Validate migrations
echo "üìã Validating migrations..."
node scripts/validate-migrations.js

# Check database health (only if Supabase is running)
echo "üè• Checking database health..."
if command -v supabase >/dev/null 2>&1; then
  if supabase status >/dev/null 2>&1; then
    node scripts/check-db-health.js
  else
    echo "‚ö†Ô∏è  Supabase not running - skipping database health check"
  fi
else
  echo "‚ö†Ô∏è  Supabase CLI not found - skipping database health check"
fi

echo "‚úÖ Pre-commit checks passed!"